
@{
    ViewData["Title"] = "Kết quả";
}

<div class="card">
    <div class="card-header bg-info" style="padding-bottom: 0px; padding-top: 5px">
        <h5 class="card-title text-white">
            Danh sách bệnh nhân có kết quả Xét nghiệm Test nhanh
        </h5>
    </div>

    <div class="row">
        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 ">
        </div>
        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 ">
            <div class="float-right">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="0" id="ckTenCongTy">
                    <label class="form-check-label" for="ckTenCongTy">
                        Hợp đồng Công ty
                    </label>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 ">
            <div class="float-right">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="0" id="ckCongSo2">
                    <label class="form-check-label" for="ckCongSo2">
                        Cổng số 2
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="card-body">
        <!-- tab -->
        <ul class="nav nav-pills">
            <li class="nav-item">
                <a href="#tab1" data-toggle="tab" class="nav-link active">Chưa in kết quả</a>
            </li>

            <li class="nav-item">
                <a href="#tab2" data-toggle="tab" class="nav-link">Đã in kết quả</a>
            </li>

            <li class="nav-item">
                <a href="#tab3" data-toggle="tab" class="nav-link">Báo cáo</a>
            </li>
        </ul>
    </div>

    <div class="card-body">
        <div class="tab-content">
            <div class="tab-pane container-fluid active" id="tab1">
                <div id="divDanhSachKqChuaIn"></div>
            </div>

            <div class="tab-pane container-fluid" id="tab2">
                <div class="row">
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <div class="form-inline">
                                <span>Từ ngày: </span>
                                <input type="date" id="dtTuNgayTab2" class="form-control ml-2" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <div class="form-inline">
                                <span>Đến ngày: </span>
                                <input type="date" id="dtDenNgayTab2" class="form-control ml-2" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                        <button id="btnLayBaoCaoTab2" type="button" class="btn btn-primary">Lấy dữ liệu</button>

                    </div>
                </div>

                <hr />

                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                        <div id="divDanhSachKqDaIn"></div>
                    </div>
                </div>




            </div>

            <div class="tab-pane container-fluid" id="tab3">
                <div class="row">
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <div class="form-inline">
                                <span>Từ ngày: </span>
                                <input type="date" id="dtTuNgay" class="form-control ml-2" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <div class="form-inline">
                                <span>Đến ngày: </span>
                                <input type="date" id="dtDenNgay" class="form-control ml-2" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                        <button id="btnLayBaoCao" type="button" class="btn btn-primary">Lấy dữ liệu</button>

                    </div>
                </div>

                <hr />

                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                        <div id="divBaoCao"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="btnAdmin">Admin</button>

    <!-- Modal validataion-->
    <div class="modal" id="myModalValidate">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Nhập mã bảo mật</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <!--Thông tin hành chính-->
                    <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                            <div class="form-group floating-control-group">
                                <input type="password" placeholder="Nhập mã bảo mật" class="form-control" style="color: blue; font-weight: bold" id="txtValidate" />
                            </div>
                        </div>
                    </div>
                    <!--End Thông tin hành chính-->
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    @*<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>*@
                    <button id="btnCheckMaBaoMat" type="button" class="btn btn-danger">Đồng ý</button>

                </div>

            </div>
        </div>
    </div>


</div>

@section Scripts{
    <script>


        function GetListKetQuaChuaIn(tenCongTy, congSo2) {
                $.ajax({
                    type: "GET",
                    url: "/Home/GetListKetQuaChuaIn",
                    //data: JSON.stringify(objArr),
                    data: { 'tenCongTy': tenCongTy, 'congSo2': congSo2 },
                    //contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (responses) {
                        if (responses === 0 || responses === "0") {
                            swal.fire("Không lấy được thông tin");
                        } else {
                            $("#divDanhSachKqChuaIn").html(responses);
                        }
                    },
                    failure: function (response) {
                        alert("failure: GetListKetQuaChuaIn Home" + response.responseText);
                    },
                    error: function (response) {
                        alert("error: GetListKetQuaChuaIn Home" + response.responseText);
                    }
                });
        }

        function GetListKetQuaDaIn(tenCongTy, congSo2) {
            var tuNgay = $("#dtTuNgayTab2").val();
            var denNgay = $("#dtDenNgayTab2").val();


            $.ajax({
                type: "GET",
                url: "/Home/GetListKetQuaDaIn",
                //data: JSON.stringify(objArr),
                data: { 'tuNgay': tuNgay, 'denNgay': denNgay, 'tenCongTy': tenCongTy, 'congSo2': congSo2 },
                //contentType: "application/json; charset=utf-8",
                dataType: "text",
                success: function (responses) {
                    if (responses === 0 || responses === "0") {
                        swal.fire("Không lấy được thông tin");
                    } else {
                        $("#divDanhSachKqDaIn").html(responses);
                    }
                },
                failure: function (response) {
                    alert("failure: GetListKetQuaDaIn KetQua" + response.responseText);
                },
                error: function (response) {
                    alert("error: GetListKetQuaDaIn KetQua" + response.responseText);
                }
            });
        }

        function LayBaoCao() {
            var tuNgay = $("#dtTuNgay").val();
            var denNgay = $("#dtDenNgay").val();


            $.ajax({
                type: "GET",
                url: "/Home/LayBaoCao",
                //data: JSON.stringify(objArr),
                data: { 'tuNgay': tuNgay, 'denNgay': denNgay },
                //contentType: "application/json; charset=utf-8",
                dataType: "text",
                success: function (responses) {
                    if (responses === 0 || responses === "0") {
                        swal.fire("Không lấy được thông tin");
                    } else {
                        $("#divBaoCao").html(responses);
                    }
                },
                failure: function (response) {
                    alert("failure: BaoCao KetQua" + response.responseText);
                },
                error: function (response) {
                    alert("error: BaoCao KetQua" + response.responseText);
                }
            });
        }

        function VaoAdmin() {
            $("#btnAdmin").click(function () {
                $("#myModalValidate").modal('show');
                $("#txtValidate").focus();
            });

            $("#btnCheckMaBaoMat").click(function () {
                NhapMaBaoMat();
            });
        };

        function NhapMaBaoMat() {
            var inputValidate = $("#txtValidate").val();
            var valueValidate = "abc";
            if (inputValidate === valueValidate) {
                $("#myModalValidate").modal('hide');
                $("#txtValidate").val(''); 

                window.location.href = '/home/admin';
            }
            else {
                alert("Mã bảo mật không đúng");
                window.location.href = '/home/';
            }
        };
        

        $(document).ready(function () {
            //setTimeout(function () {
            //    window.location.reload();

            //}, 10000);
            $("#ckTenCongTy").click(function () {
                var congSo2 = "";
                if ($("#ckCongSo2").is(":checked")) {
                    congSo2 = "1";
                }
                else {
                    congSo2 = "0";
                }

                if ($("#ckTenCongTy").is(":checked")) {
                    GetListKetQuaChuaIn('1', congSo2);
                    GetListKetQuaDaIn('1', congSo2);
                    //GetListDaLayMauCoKq('1', congSo2);
                } else {
                    GetListKetQuaChuaIn('0', congSo2);
                    GetListKetQuaDaIn('0', congSo2);
                    //GetListDaLayMauCoKq('0', congSo2);
                }
            });

            $("#ckCongSo2").click(function () {
                var tenCongTy = "";
                if ($("#ckTenCongTy").is(":checked")) {
                    tenCongTy = "1";
                }
                else {
                    tenCongTy = "0";
                }

                if ($("#ckCongSo2").is(":checked")) {
                    GetListKetQuaChuaIn(tenCongTy, '1');
                    GetListKetQuaDaIn(tenCongTy, '1');
                    //GetListDaLayMauCoKq(tenCongTy, '1');
                } else {
                    GetListKetQuaChuaIn(tenCongTy, '0');
                    GetListKetQuaDaIn(tenCongTy, '0');
                    //GetListDaLayMauCoKq(tenCongTy, '0');
                }
            });

            GetListKetQuaChuaIn('0','0');
            
            $("#btnLayBaoCao").click(function () {
                LayBaoCao();
            });

            $("#btnLayBaoCaoTab2").click(function () {
                if ($("#ckTenCongTy").is(":checked") && $("#ckCongSo2").is(":checked")) {
                    GetListKetQuaDaIn('1', '1');
                }
                else if ($("#ckTenCongTy").is(":checked") && !$("#ckCongSo2").is(":checked")) {
                    GetListKetQuaDaIn('1', '0');
                }
                else if (!$("#ckTenCongTy").is(":checked") && $("#ckCongSo2").is(":checked")) {
                    GetListKetQuaDaIn('0', '1');
                }
                else {
                    GetListKetQuaDaIn('0', '0');
                }



                //GetListKetQuaDaIn();
            });

            VaoAdmin();
            
        });
    </script>
}

